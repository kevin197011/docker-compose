services:
  confluence:
    image: haxqer/confluence:8.5.14
    container_name: confluence
    environment:
      - TZ=${TZ}
      # - JVM_MINIMUM_MEMORY=4g
      # - JVM_MAXIMUM_MEMORY=4g
      # - JVM_CODE_CACHE_ARGS='-XX:InitialCodeCacheSize=1g -XX:ReservedCodeCacheSize=4g'
    depends_on:
      - mysql
    ports:
      - "8090:8090"
    volumes:
      - ./data/confluence:/var/confluence
      - ./server.xml:/opt/confluence/conf/server.xml
    restart: always
    networks:
      - confluence_net
  mysql:
    image: mysql:8.0
    container_name: mysql
    environment:
      - TZ=${TZ}
      - MYSQL_DATABASE=${MYSQL_DATABASE}
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_USER=${MYSQL_USER}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
    command: ["mysqld", "--character-set-server=utf8mb4", "--collation-server=utf8mb4_bin", "--transaction-isolation=READ-COMMITTED", "--innodb_log_file_size=256M", "--max_allowed_packet=256M", "--log_bin_trust_function_creators=1"]
    volumes:
      - ./data/mysql:/var/lib/mysql
    restart: always
    networks:
      - confluence_net
      # nginx:
      #   image: nginx:1.25
      #   container_name: confluence_nginx
      #   ports:
      #     - "80:80"
      #     - "443:443"
      #   volumes:
      #     - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      #     - ./ssl/${SSL_CERTIFICATE}:/etc/nginx/ssl/${SSL_CERTIFICATE}:ro
      #     - ./ssl/${SSL_CERTIFICATE_KEY}:/etc/nginx/ssl/${SSL_CERTIFICATE_KEY}:ro
      #   environment:
      #     - CONFLUENCE_DOMAIN=${CONFLUENCE_DOMAIN}
      #   depends_on:
      #     - confluence
      #   restart: always
      #   networks:
      #     - confluence_net
networks:
  confluence_net:
    driver: bridge
